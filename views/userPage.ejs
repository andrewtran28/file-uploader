<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= currentUser.username %></title>
    <style>
      /* Initially hide the action buttons */
      .action-buttons {
        display: none;
        margin-left: 10px;
        cursor: pointer;
      }

      /* Show the action buttons when hovering over the file or folder name */
      .hover-container:hover .action-buttons {
        display: inline-block;
      }

      /* Styling for the folder/file name container */
      .hover-container {
        display: inline-flex;
        align-items: center;
      }

      .action-buttons button {
        margin-right: 10px;
      }

      /* Rename form styling */
      .rename-form {
        display: inline-block;
        margin-top: 10px;
      }

      /* Hide the rename form initially */
      #rename-form {
        display: none;
      }
    </style>
  </head>
  <body>
    <%- include('partials/header') %>
    <h1>Files Page: <%= currentUser.username %></h1>
    <!-- Folder Name Section -->
    <div id="folder-name-container" class="hover-container">
      <h1 id="folder-name" class="folder-name">Current Folder: <%= currentFolder.name %></h1>
      <button id="rename-btn" class="action-buttons">Rename</button>
    </div>

    <form id="rename-form" class="rename-form" action="/folder/<%= currentFolder.id %>/rename" method="POST">
      <input
        type="text"
        id="rename-input"
        name="newName"
        value="<%= currentFolder.name %>"
        placeholder="Enter new folder name"
        required
      />
      <button type="submit">Rename</button>
      <button type="button" id="cancel-btn">Cancel</button>
    </form>

    <h1>Folders</h1>
    <% if (currentFolder.subfolders.length > 0) { %>
      <% currentFolder.subfolders.forEach((folder) => { %>
        <div class="folder hover-container">
          <a href="/folder/<%= folder.id %>"><%= folder.name %></a>
          <form action="/folder/<%= folder.id %>/delete" method="POST" style="display:inline;">
            <button type="submit" onclick="return confirm('Are you sure you want to delete this folder?');">Delete</button>
          </form>
        </div>
      <% }) %>
    <% } %>
    <% if (currentFolder.parent_id !== null) { %>
      <a href="/folder/<%= currentFolder.parent_id %>">
        Go back to parent directory
      </a>
    <% } %>

    <% if (files.length > 0) { %>
      <h1>Files</h1>
      <% files.forEach((file) => { %>
        <div class="file hover-container">
          <span><a href="<%= file.url %>"><%= file.name %></a></span>
          <span><%= file.size %></span>
          <!-- Action buttons for file (download/delete) -->
          <div class="action-buttons">
            <a href="<%= file.url %>" download><button>Download</button></a>
            <form action="/folder/<%= currentFolder.id %>/deleteFile" method="POST" style="display:inline;">
              <input type="hidden" name="fileId" value="<%= file.id %>">
              <button type="submit" onclick="return confirm('Are you sure you want to delete this file?');">Delete</button>
            </form>
          </div>
        </div>
        <br>
      <% }) %>
    <% } %>

    <h2>Create New Folder</h2>
    <form
      action="/folder/<%= currentFolder.id %>/create"
      method="POST"
    >
      <label for="folderName">Folder Name: </label>
      <input type="text" id="folderName" name="folderName" required />
      <button type="submit">Create Folder</button>
    </form>

    <h2>Upload a File</h2>
    <form
      action="/folder/<%= currentFolder.id %>/uploadFile"
      method="POST"
      enctype="multipart/form-data"
    >
      <label for="file">Choose a file:</label>
      <input id="file" type="file" name="file" required />
      <button type="submit">Upload</button>
    </form>

    <script>
      // Show the rename form when the "Rename" button is clicked
      document.getElementById('rename-btn').addEventListener('click', function() {
        document.getElementById('folder-name').style.display = 'none';
        document.getElementById('rename-btn').style.display = 'none';
        document.getElementById('rename-form').style.display = 'inline-block';
      });

      // Hide the rename form when the "Cancel" button is clicked
      document.getElementById('cancel-btn').addEventListener('click', function() {
        document.getElementById('folder-name').style.display = 'block';
        document.getElementById('rename-btn').style.display = 'inline-block';
        document.getElementById('rename-form').style.display = 'none';
      });
    </script>
  </body>
</html>
