<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= currentUser.username %></title>
    <style>
      /* Initially hide the rename button */
      .rename-button {
        display: none;
        margin-left: 10px;
        cursor: pointer;
      }
  
      /* Show the rename button when hovering over the folder name */
      #folder-name-container:hover .rename-button {
        display: inline-block;
      }
  
      /* Styling for the folder name container */
      #folder-name-container {
        display: inline-flex;
        align-items: center;
      }
  
      .rename-form {
        display: inline-block;
        margin-top: 10px;
      }
  
      /* Styling for buttons */
      .rename-form button {
        margin-right: 10px;
      }
    </style>
  </head>
  <body>
    <%- include('partials/header') %>
    <h1>Files Page: <%= currentUser.username %></h1>
    <div id="folder-name-container">
      <h1 id="folder-name" class="folder-name">Current Folder: <%= currentFolder.name %></h1>
      <button id="rename-btn" class="rename-button">Rename</button>
    </div>

    <!-- Rename Folder Form -->
    <form id="rename-form" class="rename-form" action="/folder/<%= currentFolder.id %>/rename" method="POST" style="display: none;">
      <input
        type="text"
        id="rename-input"
        name="newName"
        value="<%= currentFolder.name %>"
        placeholder="Enter new folder name"
        required
      />
      <button type="submit">Rename</button>
      <button type="button" id="cancel-btn">Cancel</button>
    </form>

    <h1>Folders</h1>
    <% if (currentFolder.subfolders.length > 0) { %>

      <% currentFolder.subfolders.forEach((folder) => { %>
        <div class="folder">
          <a href="/folder/<%= folder.id %>">
            <%= folder.name %>
          </a>
          <form action="/folder/<%= folder.id %>/delete" method="POST" style="display:inline;">
            <button type="submit" onclick="return confirm('Are you sure you want to delete this folder?');">Delete</button>
          </form>
        </div>
      <% }) %>
    <% } %>

    <% if (currentFolder.parent_id !== null) { %>
      <a href="/folder/<%= currentFolder.parent_id %>">
        Go back to parent directory
      </a>
    <% } %>
    
    <% if (files.length > 0) { %>
      <h1>Files</h1>
      <% files.forEach((file) => { %>
        <div class="file"><%= file.name %></div>
      <% }) %>
    <% } %>

    <h2>Create New Folder</h2>
    <form
      action="/folder/<%= currentFolder.id %>/create"
      method="POST"
    >
      <label for="folderName">Folder Name: </label>
      <input type="text" id="folderName" name="folderName" required />
      <button type="submit">Create Folder</button>
    </form>

    <h2>Upload a File</h2>
    <form
      action="/folder/<%= currentFolder.id %>/upload"
      method="POST"
      enctype="multipart/form-data"
    >
      <label for="file">Choose a file:</label>
      <input id="file" type="file" name="file" required />
      <button type="submit">Upload</button>
    </form>

    <script>
      // Show the rename form when the "Rename" button is clicked
      document.getElementById('rename-btn').addEventListener('click', function() {
        document.getElementById('folder-name').style.display = 'none';
        document.getElementById('rename-btn').style.display = 'none';
        document.getElementById('rename-form').style.display = 'inline-block';
      });
  
      // Hide the rename form when the "Cancel" button is clicked
      document.getElementById('cancel-btn').addEventListener('click', function() {
        document.getElementById('folder-name').style.display = 'block';
        document.getElementById('rename-btn').style.display = 'inline-block';
        document.getElementById('rename-form').style.display = 'none';
      });
    </script>
  </body>
</html>
