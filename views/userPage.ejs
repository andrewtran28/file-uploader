<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= currentUser.username %></title>
  </head>
  <body>
    <%- include('partials/header') %>
    <h1>Files Page: <%= currentUser.username %></h1>
    <h1>Current Folder: <%= currentFolder.name %></h1>
    <div><%= files %></div>

    <% if (currentFolder.subfolders.length > 0) { %>
      <h1>Folders</h1>
      <% currentFolder.subfolders.forEach((folder) => { %>
        <div class="folder">
          <a href="/user/<%= currentUser.id %>/folder/<%= folder.id %>">
            <%= folder.name %>
          </a>
          <form action="/user/<%= currentUser.id %>/folder/<%= folder.id %>/deletefolder" method="POST" style="display:inline;">
            <button type="submit" onclick="return confirm('Are you sure you want to delete this folder?');">Delete</button>
          </form>
        </div>
      <% }) %>
    <% } %>
    
    <% if (files.length > 0) { %>
      <h1>All Files</h1>
      <% files.forEach((file) => { %>
        <div class="file"><%= file.name %></div>
      <% }) %>
    <% } %>

    <% if (currentFolder.parent_id !== null) { %>
      <a href="/user/<%= currentUser.id %>/folder/<%= currentFolder.parent_id %>">
        Go back to parent directory
      </a>
    <% } %>

    <h2>Create New Folder</h2>
    <form
      action="/user/<%= currentUser.id %>/folder/<%= currentFolder.id %>/createfolder"
      method="POST"
    >
      <label for="folderName">Folder Name: </label>
      <input type="text" id="folderName" name="folderName" required />
      <button type="submit">Create Folder</button>
    </form>
  </body>
</html>
